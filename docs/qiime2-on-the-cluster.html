<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 QIIME2 ON THE CLUSTER | 16S Microbiome Analysis on a Computing Cluster</title>
  <meta name="description" content="4 QIIME2 ON THE CLUSTER | 16S Microbiome Analysis on a Computing Cluster" />
  <meta name="generator" content="bookdown 0.34 and GitBook 2.6.7" />

  <meta property="og:title" content="4 QIIME2 ON THE CLUSTER | 16S Microbiome Analysis on a Computing Cluster" />
  <meta property="og:type" content="book" />
  
  
  <meta name="github-repo" content="johannabosch/QIIME2_for_Graham" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 QIIME2 ON THE CLUSTER | 16S Microbiome Analysis on a Computing Cluster" />
  
  
  

<meta name="author" content="Johanna Bosch" />


<meta name="date" content="2023-10-23" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="importing-data.html"/>
<link rel="next" href="getting-started-with-qiime2.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Comparative 16S Amplicon Analysis using QIIME2 on a computing cluster: Tutorial and Resources</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome!</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> <strong>INTRODUCTION</strong></a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#a-brief-project-review"><i class="fa fa-check"></i><b>1.1</b> <strong>A brief project review</strong></a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="introduction.html"><a href="introduction.html#study-species-and-sites"><i class="fa fa-check"></i><b>1.1.1</b> Study species and sites</a></li>
<li class="chapter" data-level="1.1.2" data-path="introduction.html"><a href="introduction.html#sequencing-library-prep"><i class="fa fa-check"></i><b>1.1.2</b> Sequencing &amp; library prep</a></li>
<li class="chapter" data-level="1.1.3" data-path="introduction.html"><a href="introduction.html#files-after-sequencing"><i class="fa fa-check"></i><b>1.1.3</b> Files after sequencing</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#dna-analysis"><i class="fa fa-check"></i><b>1.2</b> <strong>DNA analysis</strong></a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="introduction.html"><a href="introduction.html#the-graham-cluster"><i class="fa fa-check"></i><b>1.2.1</b> The Graham cluster</a></li>
<li class="chapter" data-level="1.2.2" data-path="introduction.html"><a href="introduction.html#data-accessibility"><i class="fa fa-check"></i><b>1.2.2</b> Data accessibility</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="compute-canada-basics.html"><a href="compute-canada-basics.html"><i class="fa fa-check"></i><b>2</b> <strong>COMPUTE CANADA BASICS</strong></a>
<ul>
<li class="chapter" data-level="2.1" data-path="compute-canada-basics.html"><a href="compute-canada-basics.html#cluster-computing-basics"><i class="fa fa-check"></i><b>2.1</b> <strong>Cluster computing basics</strong></a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="compute-canada-basics.html"><a href="compute-canada-basics.html#signing-into-the-cluster"><i class="fa fa-check"></i><b>2.1.1</b> Signing into the cluster</a></li>
<li class="chapter" data-level="2.1.2" data-path="compute-canada-basics.html"><a href="compute-canada-basics.html#basic-computing-commands"><i class="fa fa-check"></i><b>2.1.2</b> Basic computing commands</a></li>
<li class="chapter" data-level="2.1.3" data-path="compute-canada-basics.html"><a href="compute-canada-basics.html#loading-modules"><i class="fa fa-check"></i><b>2.1.3</b> Loading modules</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="compute-canada-basics.html"><a href="compute-canada-basics.html#job-scripts"><i class="fa fa-check"></i><b>2.2</b> <strong>Job scripts </strong></a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="compute-canada-basics.html"><a href="compute-canada-basics.html#using-nano"><i class="fa fa-check"></i><b>2.2.1</b> Using Nano</a></li>
<li class="chapter" data-level="2.2.2" data-path="compute-canada-basics.html"><a href="compute-canada-basics.html#writing-a-bash-script"><i class="fa fa-check"></i><b>2.2.2</b> Writing a bash script</a></li>
<li class="chapter" data-level="2.2.3" data-path="compute-canada-basics.html"><a href="compute-canada-basics.html#running-scripts-on-the-scheduler"><i class="fa fa-check"></i><b>2.2.3</b> Running scripts on the scheduler</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="importing-data.html"><a href="importing-data.html"><i class="fa fa-check"></i><b>3</b> <strong>IMPORTING DATA</strong></a>
<ul>
<li class="chapter" data-level="3.1" data-path="importing-data.html"><a href="importing-data.html#getting-organized"><i class="fa fa-check"></i><b>3.1</b> <strong>Getting organized</strong></a></li>
<li class="chapter" data-level="3.2" data-path="importing-data.html"><a href="importing-data.html#moving-data-to-the-cluster"><i class="fa fa-check"></i><b>3.2</b> <strong>Moving data to the cluster</strong></a></li>
<li class="chapter" data-level="3.3" data-path="importing-data.html"><a href="importing-data.html#organizing-.fastq-files"><i class="fa fa-check"></i><b>3.3</b> <strong>Organizing .FASTQ files</strong></a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="importing-data.html"><a href="importing-data.html#unzip-rawdata-files"><i class="fa fa-check"></i><b>3.3.1</b> Unzip rawdata files</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="qiime2-on-the-cluster.html"><a href="qiime2-on-the-cluster.html"><i class="fa fa-check"></i><b>4</b> <strong>QIIME2 ON THE CLUSTER</strong></a>
<ul>
<li class="chapter" data-level="4.1" data-path="qiime2-on-the-cluster.html"><a href="qiime2-on-the-cluster.html#use-qiime2-via-apptainer"><i class="fa fa-check"></i><b>4.1</b> <strong>Use QIIME2 via Apptainer</strong></a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="qiime2-on-the-cluster.html"><a href="qiime2-on-the-cluster.html#finding-physical-paths"><i class="fa fa-check"></i><b>4.1.1</b> Finding physical paths</a></li>
<li class="chapter" data-level="4.1.2" data-path="qiime2-on-the-cluster.html"><a href="qiime2-on-the-cluster.html#using-apptainer-mounts"><i class="fa fa-check"></i><b>4.1.2</b> Using Apptainer mounts</a></li>
<li class="chapter" data-level="4.1.3" data-path="qiime2-on-the-cluster.html"><a href="qiime2-on-the-cluster.html#getting-help"><i class="fa fa-check"></i><b>4.1.3</b> Getting help</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="getting-started-with-qiime2.html"><a href="getting-started-with-qiime2.html"><i class="fa fa-check"></i><b>5</b> <strong>GETTING STARTED WITH QIIME2</strong></a>
<ul>
<li class="chapter" data-level="5.1" data-path="getting-started-with-qiime2.html"><a href="getting-started-with-qiime2.html#creating-artifact-files"><i class="fa fa-check"></i><b>5.1</b> <strong>Creating artifact files</strong></a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="getting-started-with-qiime2.html"><a href="getting-started-with-qiime2.html#import-the-.fastq-files"><i class="fa fa-check"></i><b>5.1.1</b> Import the .FASTQ files</a></li>
<li class="chapter" data-level="5.1.2" data-path="getting-started-with-qiime2.html"><a href="getting-started-with-qiime2.html#inspect-the-.qza-files"><i class="fa fa-check"></i><b>5.1.2</b> Inspect the .QZA files</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="getting-started-with-qiime2.html"><a href="getting-started-with-qiime2.html#visualizing-artifact-files"><i class="fa fa-check"></i><b>5.2</b> <strong>Visualizing artifact files</strong></a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="getting-started-with-qiime2.html"><a href="getting-started-with-qiime2.html#create-a-summary-report"><i class="fa fa-check"></i><b>5.2.1</b> Create a summary report</a></li>
<li class="chapter" data-level="5.2.2" data-path="getting-started-with-qiime2.html"><a href="getting-started-with-qiime2.html#using-qiime2s-web-app"><i class="fa fa-check"></i><b>5.2.2</b> Using QIIME2’s web-app</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="data-preprocessing.html"><a href="data-preprocessing.html"><i class="fa fa-check"></i><b>6</b> <strong>DATA PREPROCESSING</strong></a>
<ul>
<li class="chapter" data-level="6.1" data-path="data-preprocessing.html"><a href="data-preprocessing.html#quality-assessment"><i class="fa fa-check"></i><b>6.1</b> <strong>Quality assessment</strong></a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="data-preprocessing.html"><a href="data-preprocessing.html#fastqc"><i class="fa fa-check"></i><b>6.1.1</b> FastQC</a></li>
<li class="chapter" data-level="6.1.2" data-path="data-preprocessing.html"><a href="data-preprocessing.html#multiqc"><i class="fa fa-check"></i><b>6.1.2</b> MultiQC</a></li>
<li class="chapter" data-level="6.1.3" data-path="data-preprocessing.html"><a href="data-preprocessing.html#visualizing-data-quality"><i class="fa fa-check"></i><b>6.1.3</b> Visualizing data quality</a></li>
<li class="chapter" data-level="6.1.4" data-path="data-preprocessing.html"><a href="data-preprocessing.html#plot-types"><i class="fa fa-check"></i><b>6.1.4</b> Plot types</a></li>
<li class="chapter" data-level="6.1.5" data-path="data-preprocessing.html"><a href="data-preprocessing.html#for-this-study"><i class="fa fa-check"></i><b>6.1.5</b> For this study</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="data-preprocessing.html"><a href="data-preprocessing.html#data-cleaning"><i class="fa fa-check"></i><b>6.2</b> <strong>Data Cleaning</strong></a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="data-preprocessing.html"><a href="data-preprocessing.html#trimming-primers"><i class="fa fa-check"></i><b>6.2.1</b> Trimming primers</a></li>
<li class="chapter" data-level="6.2.2" data-path="data-preprocessing.html"><a href="data-preprocessing.html#summarizing-data"><i class="fa fa-check"></i><b>6.2.2</b> Summarizing data</a></li>
<li class="chapter" data-level="6.2.3" data-path="data-preprocessing.html"><a href="data-preprocessing.html#joining-read-pairs"><i class="fa fa-check"></i><b>6.2.3</b> Joining read pairs</a></li>
<li class="chapter" data-level="6.2.4" data-path="data-preprocessing.html"><a href="data-preprocessing.html#quality-filtering"><i class="fa fa-check"></i><b>6.2.4</b> Quality filtering</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="data-preprocessing.html"><a href="data-preprocessing.html#data-transformation"><i class="fa fa-check"></i><b>6.3</b> <strong>Data transformation</strong></a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="data-preprocessing.html"><a href="data-preprocessing.html#constructing-asvs"><i class="fa fa-check"></i><b>6.3.1</b> Constructing ASV’s</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="data-preprocessing.html"><a href="data-preprocessing.html#data-reduction"><i class="fa fa-check"></i><b>6.4</b> <strong>Data reduction</strong></a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="data-preprocessing.html"><a href="data-preprocessing.html#filtering-unique-reads"><i class="fa fa-check"></i><b>6.4.1</b> Filtering unique reads</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="data-preprocessing.html"><a href="data-preprocessing.html#manipulating-tables"><i class="fa fa-check"></i><b>6.5</b> <strong>Manipulating tables</strong></a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="data-preprocessing.html"><a href="data-preprocessing.html#merging-feature-tables"><i class="fa fa-check"></i><b>6.5.1</b> Merging feature tables</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="diversity-analyses.html"><a href="diversity-analyses.html"><i class="fa fa-check"></i><b>7</b> <strong>DIVERSITY ANALYSES</strong></a>
<ul>
<li class="chapter" data-level="7.1" data-path="diversity-analyses.html"><a href="diversity-analyses.html#build-a-phylogenetic-tree"><i class="fa fa-check"></i><b>7.1</b> <strong>Build a phylogenetic tree</strong></a></li>
<li class="chapter" data-level="7.2" data-path="diversity-analyses.html"><a href="diversity-analyses.html#generating-alpha-rarefaction-curves"><i class="fa fa-check"></i><b>7.2</b> <strong>Generating alpha rarefaction curves</strong></a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="diversity-analyses.html"><a href="diversity-analyses.html#finding-max-depth"><i class="fa fa-check"></i><b>7.2.1</b> Finding max depth</a></li>
<li class="chapter" data-level="7.2.2" data-path="diversity-analyses.html"><a href="diversity-analyses.html#generating-the-curve"><i class="fa fa-check"></i><b>7.2.2</b> Generating the curve</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="diversity-analyses.html"><a href="diversity-analyses.html#alpha-and-beta-diversity"><i class="fa fa-check"></i><b>7.3</b> <strong>Alpha and beta diversity</strong></a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="diversity-analyses.html"><a href="diversity-analyses.html#running-diversity-analyses"><i class="fa fa-check"></i><b>7.3.1</b> Running diversity analyses</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="assigning-taxonomy.html"><a href="assigning-taxonomy.html"><i class="fa fa-check"></i><b>8</b> <strong>ASSIGNING TAXONOMY</strong></a>
<ul>
<li class="chapter" data-level="8.1" data-path="assigning-taxonomy.html"><a href="assigning-taxonomy.html#classifying-asvs"><i class="fa fa-check"></i><b>8.1</b> <strong>Classifying ASV’s</strong></a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="assigning-taxonomy.html"><a href="assigning-taxonomy.html#using-scikit-learn"><i class="fa fa-check"></i><b>8.1.1</b> Using scikit-learn</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="assigning-taxonomy.html"><a href="assigning-taxonomy.html#verifying-with-blastn"><i class="fa fa-check"></i><b>8.2</b> <strong>Verifying with BLASTn</strong></a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="assigning-taxonomy.html"><a href="assigning-taxonomy.html#filtering-contaminants"><i class="fa fa-check"></i><b>8.2.1</b> Filtering contaminants</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="assigning-taxonomy.html"><a href="assigning-taxonomy.html#grouping-feature-tables"><i class="fa fa-check"></i><b>8.3</b> <strong>Grouping feature tables</strong></a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="visualizing-taxonomic-data.html"><a href="visualizing-taxonomic-data.html"><i class="fa fa-check"></i><b>9</b> <strong>VISUALIZING TAXONOMIC DATA</strong></a>
<ul>
<li class="chapter" data-level="9.1" data-path="visualizing-taxonomic-data.html"><a href="visualizing-taxonomic-data.html#exporting-data"><i class="fa fa-check"></i><b>9.1</b> <strong>Exporting data</strong></a></li>
<li class="chapter" data-level="9.2" data-path="visualizing-taxonomic-data.html"><a href="visualizing-taxonomic-data.html#importing-q2-files-to-r"><i class="fa fa-check"></i><b>9.2</b> <strong>Importing Q2 files to R</strong></a></li>
<li class="chapter" data-level="9.3" data-path="visualizing-taxonomic-data.html"><a href="visualizing-taxonomic-data.html#qiime2r"><i class="fa fa-check"></i><b>9.3</b> <strong>QIIME2R</strong></a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="visualizing-taxonomic-data.html"><a href="visualizing-taxonomic-data.html#load-the-feature-table"><i class="fa fa-check"></i><b>9.3.1</b> Load the feature table</a></li>
<li class="chapter" data-level="9.3.2" data-path="visualizing-taxonomic-data.html"><a href="visualizing-taxonomic-data.html#load-the-metadata"><i class="fa fa-check"></i><b>9.3.2</b> Load the metadata</a></li>
<li class="chapter" data-level="9.3.3" data-path="visualizing-taxonomic-data.html"><a href="visualizing-taxonomic-data.html#load-the-taxonomic-data"><i class="fa fa-check"></i><b>9.3.3</b> Load the taxonomic data</a></li>
<li class="chapter" data-level="9.3.4" data-path="visualizing-taxonomic-data.html"><a href="visualizing-taxonomic-data.html#parsing-taxonomic-data"><i class="fa fa-check"></i><b>9.3.4</b> Parsing taxonomic data</a></li>
<li class="chapter" data-level="9.3.5" data-path="visualizing-taxonomic-data.html"><a href="visualizing-taxonomic-data.html#create-a-taxa-barplot"><i class="fa fa-check"></i><b>9.3.5</b> Create a taxa barplot</a></li>
<li class="chapter" data-level="9.3.6" data-path="visualizing-taxonomic-data.html"><a href="visualizing-taxonomic-data.html#create-a-taxa-heatmap"><i class="fa fa-check"></i><b>9.3.6</b> Create a taxa heatmap</a></li>
<li class="chapter" data-level="9.3.7" data-path="visualizing-taxonomic-data.html"><a href="visualizing-taxonomic-data.html#plot-beta-diversity"><i class="fa fa-check"></i><b>9.3.7</b> Plot beta-diversity</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="visualizing-taxonomic-data.html"><a href="visualizing-taxonomic-data.html#phyloseq"><i class="fa fa-check"></i><b>9.4</b> <strong>Phyloseq</strong></a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="visualizing-taxonomic-data.html"><a href="visualizing-taxonomic-data.html#build-a-phyloseq-object"><i class="fa fa-check"></i><b>9.4.1</b> Build a phyloseq object</a></li>
<li class="chapter" data-level="9.4.2" data-path="visualizing-taxonomic-data.html"><a href="visualizing-taxonomic-data.html#taxonomic-characteristics"><i class="fa fa-check"></i><b>9.4.2</b> Taxonomic characteristics</a></li>
<li class="chapter" data-level="9.4.3" data-path="visualizing-taxonomic-data.html"><a href="visualizing-taxonomic-data.html#plot-alpha-diversity"><i class="fa fa-check"></i><b>9.4.3</b> Plot alpha-diversity</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="resources.html"><a href="resources.html"><i class="fa fa-check"></i><b>10</b> <strong>Resources:</strong></a>
<ul>
<li class="chapter" data-level="10.1" data-path="resources.html"><a href="resources.html#data-in-this-analysis"><i class="fa fa-check"></i><b>10.1</b> <strong>Data in this analysis</strong></a></li>
<li class="chapter" data-level="10.2" data-path="resources.html"><a href="resources.html#other-resources"><i class="fa fa-check"></i><b>10.2</b> <strong>Other resources</strong></a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="acknowledgments.html"><a href="acknowledgments.html"><i class="fa fa-check"></i><b>11</b> Acknowledgments</a></li>
<li class="chapter" data-level="12" data-path="technical-support.html"><a href="technical-support.html"><i class="fa fa-check"></i><b>12</b> <strong>Technical Support</strong></a></li>
<li class="chapter" data-level="13" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>13</b> <strong>References</strong></a>
<ul>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html#references-1"><i class="fa fa-check"></i><strong>References</strong></a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">16S Microbiome Analysis on a Computing Cluster</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="qiime2-on-the-cluster" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">4</span> <strong>QIIME2 ON THE CLUSTER</strong><a href="qiime2-on-the-cluster.html#qiime2-on-the-cluster" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Qiime2 is now an available module on the Graham cluster. Apptainer <strong>[5]</strong> is a container system that’s required to access QIIME2 because all qiime commands are executed within a containerized environment. Apptainer facilitates the management and execution of containers - a standard unit of software that packages up code and all its dependencies so an application like QIIME2 can run seamlessly. To employ the QIIME2 platform using Apptainer, users need to define specific folder bindings within the container by setting the <code>APPTAINER_BIND</code> environment variable. This ensures that the container can access and interact with the necessary data and directories. Additionally, Apptainer has replaced Singularity for this purpose, providing improved features and compatibility, all while preserving backward compatibility.</p>
<div id="use-qiime2-via-apptainer" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> <strong>Use QIIME2 via Apptainer</strong><a href="qiime2-on-the-cluster.html#use-qiime2-via-apptainer" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="finding-physical-paths" class="section level3 hasAnchor" number="4.1.1">
<h3><span class="header-section-number">4.1.1</span> Finding physical paths<a href="qiime2-on-the-cluster.html#finding-physical-paths" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Apptainer allows you to map directories on your host system to directories within an Apptainer container using bind mounts. This enables seamless reading and writing of data between the host system and the container. On the cluster, it can be configured through user-defined bind paths that you specify in your code, providing flexibility in managing file access between the host and the container. To connect to and use Apptainer mounts, you have to define the path to your physical directory without using symbolic links (Apptainer is not compatible with symbolic links).</p>
<p><strong>What is a symbolic link?</strong> - When you navigate to your home directory on the cluster, usually you’ll use a command that looks something like this: <code>cd projects/def-&lt;group-name&gt;/&lt;user-ID&gt;/</code>. Let’s say your group name is <code>birch</code>, then the symbolic link to your project directory is <code>def-birch</code>. The symbolic links we use on the Graham, Béluga, Cedar, and Narval clusters serve as shortcuts or pointers to group-specific directories, making it easier for users to navigate and work within their respective project spaces.</p>
<p><strong>What is a physical path?</strong> - The physical path represents the real, tangible location of data on a storage medium.Symbolic paths are more about providing convenience and abstraction, while physical paths represent the concrete location of data on storage media.</p>
<p>Given this info, let’s start by finding the physical path of our user directory with the <code>ls -l</code> or <code>pwd -P</code> command:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="qiime2-on-the-cluster.html#cb25-1" tabindex="-1"></a><span class="co">#navigate to your user directory</span></span>
<span id="cb25-2"><a href="qiime2-on-the-cluster.html#cb25-2" tabindex="-1"></a>cd projects<span class="sc">/</span>def<span class="sc">-</span><span class="er">&lt;</span>group<span class="sc">-</span>name<span class="sc">&gt;</span><span class="er">/&lt;</span>user<span class="sc">-</span>ID<span class="sc">&gt;</span><span class="er">/</span>amplicon<span class="sc">-</span>analysis</span>
<span id="cb25-3"><a href="qiime2-on-the-cluster.html#cb25-3" tabindex="-1"></a></span>
<span id="cb25-4"><a href="qiime2-on-the-cluster.html#cb25-4" tabindex="-1"></a><span class="co">#use the `ls` command</span></span>
<span id="cb25-5"><a href="qiime2-on-the-cluster.html#cb25-5" tabindex="-1"></a>ls <span class="sc">-</span>l <span class="sc">/</span>home<span class="sc">/</span>jlb686<span class="sc">/</span>projects<span class="sc">/</span></span>
<span id="cb25-6"><a href="qiime2-on-the-cluster.html#cb25-6" tabindex="-1"></a>  </span>
<span id="cb25-7"><a href="qiime2-on-the-cluster.html#cb25-7" tabindex="-1"></a><span class="do">## OUTPUT:</span></span>
<span id="cb25-8"><a href="qiime2-on-the-cluster.html#cb25-8" tabindex="-1"></a></span>
<span id="cb25-9"><a href="qiime2-on-the-cluster.html#cb25-9" tabindex="-1"></a>total <span class="dv">0</span></span>
<span id="cb25-10"><a href="qiime2-on-the-cluster.html#cb25-10" tabindex="-1"></a>lrwxrwxrwx <span class="dv">1</span> <span class="sc">&lt;</span>user<span class="sc">-</span>ID<span class="sc">&gt;</span> <span class="er">&lt;</span>user<span class="sc">-</span>ID<span class="sc">&gt;</span> <span class="dv">16</span> Nov <span class="dv">10</span>  <span class="dv">2021</span> def<span class="sc">-</span><span class="er">&lt;</span>group<span class="sc">-</span>name<span class="sc">&gt;</span> <span class="ot">-&gt;</span> <span class="er">/</span>project<span class="sc">/</span><span class="dv">6011879</span></span>
<span id="cb25-11"><a href="qiime2-on-the-cluster.html#cb25-11" tabindex="-1"></a></span>
<span id="cb25-12"><a href="qiime2-on-the-cluster.html#cb25-12" tabindex="-1"></a></span>
<span id="cb25-13"><a href="qiime2-on-the-cluster.html#cb25-13" tabindex="-1"></a><span class="co"># Alternatively, use `pwd -P`:</span></span>
<span id="cb25-14"><a href="qiime2-on-the-cluster.html#cb25-14" tabindex="-1"></a>pwd <span class="sc">-</span>P</span>
<span id="cb25-15"><a href="qiime2-on-the-cluster.html#cb25-15" tabindex="-1"></a></span>
<span id="cb25-16"><a href="qiime2-on-the-cluster.html#cb25-16" tabindex="-1"></a><span class="do">## OUTPUT:</span></span>
<span id="cb25-17"><a href="qiime2-on-the-cluster.html#cb25-17" tabindex="-1"></a><span class="sc">/</span>project<span class="sc">/</span><span class="dv">6011879</span><span class="sc">/</span><span class="er">&lt;</span>user<span class="sc">-</span>ID<span class="sc">&gt;</span><span class="er">/</span>amplicon<span class="sc">-</span>analysis</span></code></pre></div>
<p>The output of the <code>ls -l</code> or <code>pwd -P</code> command provides the physical path for <code>def-&lt;group-name&gt;</code>, which in this example is <code>project/6011879</code>.</p>
</div>
<div id="using-apptainer-mounts" class="section level3 hasAnchor" number="4.1.2">
<h3><span class="header-section-number">4.1.2</span> Using Apptainer mounts<a href="qiime2-on-the-cluster.html#using-apptainer-mounts" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Now that the physical path has been found, here is an example of a bash script using Apptainer to run a QIIME2 command. These scripts can easily be written using Nano. I discussed how to use Nano in Ch-02 (Computing Basics). The Apptainer mount is set to the <code>/project/6011879/&lt;user-ID&gt;/amplicon-analysis</code> directory.</p>
<p>These QIIME2 scripts should always include the shebang line (<code>#!/bin/bash</code>), the amount of time memory to use, and the two <code>export</code> commands you see below:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="qiime2-on-the-cluster.html#cb26-1" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb26-2"><a href="qiime2-on-the-cluster.html#cb26-2" tabindex="-1"></a><span class="co">#SBATCH --time=</span></span>
<span id="cb26-3"><a href="qiime2-on-the-cluster.html#cb26-3" tabindex="-1"></a><span class="co">#SBATCH --mem=</span></span>
<span id="cb26-4"><a href="qiime2-on-the-cluster.html#cb26-4" tabindex="-1"></a></span>
<span id="cb26-5"><a href="qiime2-on-the-cluster.html#cb26-5" tabindex="-1"></a>export APPTAINER_BIND<span class="ot">=</span><span class="er">/</span>project<span class="sc">/</span><span class="dv">6011879</span><span class="sc">/</span><span class="er">&lt;</span>user<span class="sc">-</span>ID<span class="sc">&gt;</span><span class="er">/:/</span>data</span>
<span id="cb26-6"><a href="qiime2-on-the-cluster.html#cb26-6" tabindex="-1"></a>export APPTAINER_WORKDIR<span class="ot">=</span><span class="er">$</span>{SLURM_TMPDIR}</span>
<span id="cb26-7"><a href="qiime2-on-the-cluster.html#cb26-7" tabindex="-1"></a></span>
<span id="cb26-8"><a href="qiime2-on-the-cluster.html#cb26-8" tabindex="-1"></a>module load qiime2<span class="sc">/</span><span class="fl">2023.5</span></span>
<span id="cb26-9"><a href="qiime2-on-the-cluster.html#cb26-9" tabindex="-1"></a></span>
<span id="cb26-10"><a href="qiime2-on-the-cluster.html#cb26-10" tabindex="-1"></a><span class="st">&#39;qiime command here&#39;</span></span></code></pre></div>
<blockquote>
<p>The <code>APPTAINER_BIND</code> line connects a folder on your computer, <code>/project/_____</code>, with a folder inside the Apptainer container, <code>/data/</code>. It’s like creating a bridge between your files and the container, so you can easily access your data from within the container. Make sure to replace this example physical path (<code>project/6011879</code>) with your own physical path number.</p>
</blockquote>
<blockquote>
<p>The <code>APPTAINER_WORKDIR=${SLURM_TMPDIR}</code> line tells the container where to do its work. Even though the container starts in a temporary directory (<code>SLURM_TMPDIR</code>), the earlier bind means you can still reach your original data from within the container through the <code>/data/</code> folder. This way, you can keep your files organized and work on them effectively.</p>
</blockquote>
<blockquote>
<p>So, you’re essentially using Apptainer to connect your data with the container and instructing the container to do its work in a temporary directory while still having easy access to your data. It’s like having a workspace inside a bigger office where your files are stored separately, but you can quickly grab what you need when you’re working.
Once the script is written in nano, press <strong>ctrl + X</strong>, name the script (usually ending in <code>.sh</code>), save and exit. Here are some tips to run the script and perform other commands related to job scripts:</p>
</blockquote>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="qiime2-on-the-cluster.html#cb27-1" tabindex="-1"></a><span class="co"># run the script</span></span>
<span id="cb27-2"><a href="qiime2-on-the-cluster.html#cb27-2" tabindex="-1"></a>sbatch <span class="st">&#39;script&#39;</span>.sh</span>
<span id="cb27-3"><a href="qiime2-on-the-cluster.html#cb27-3" tabindex="-1"></a></span>
<span id="cb27-4"><a href="qiime2-on-the-cluster.html#cb27-4" tabindex="-1"></a><span class="co"># check the job status</span></span>
<span id="cb27-5"><a href="qiime2-on-the-cluster.html#cb27-5" tabindex="-1"></a>sq <span class="sc">-</span>u <span class="st">&#39;script&#39;</span>.sh</span>
<span id="cb27-6"><a href="qiime2-on-the-cluster.html#cb27-6" tabindex="-1"></a></span>
<span id="cb27-7"><a href="qiime2-on-the-cluster.html#cb27-7" tabindex="-1"></a><span class="co"># check the slurm file once the job is complete</span></span>
<span id="cb27-8"><a href="qiime2-on-the-cluster.html#cb27-8" tabindex="-1"></a>view slurm<span class="sc">-</span><span class="st">&#39;jobID&#39;</span></span>
<span id="cb27-9"><a href="qiime2-on-the-cluster.html#cb27-9" tabindex="-1"></a><span class="co">#press the shift key while scrolling to view the whole file</span></span>
<span id="cb27-10"><a href="qiime2-on-the-cluster.html#cb27-10" tabindex="-1"></a></span>
<span id="cb27-11"><a href="qiime2-on-the-cluster.html#cb27-11" tabindex="-1"></a><span class="co"># check how much memory the build used for future reference</span></span>
<span id="cb27-12"><a href="qiime2-on-the-cluster.html#cb27-12" tabindex="-1"></a>seff <span class="st">&#39;jobID&#39;</span></span>
<span id="cb27-13"><a href="qiime2-on-the-cluster.html#cb27-13" tabindex="-1"></a></span>
<span id="cb27-14"><a href="qiime2-on-the-cluster.html#cb27-14" tabindex="-1"></a><span class="co">#move the script to the /scripts directory</span></span>
<span id="cb27-15"><a href="qiime2-on-the-cluster.html#cb27-15" tabindex="-1"></a>mv <span class="st">&#39;script&#39;</span>.sh <span class="sc">/</span>scripts</span>
<span id="cb27-16"><a href="qiime2-on-the-cluster.html#cb27-16" tabindex="-1"></a></span>
<span id="cb27-17"><a href="qiime2-on-the-cluster.html#cb27-17" tabindex="-1"></a><span class="co">#remove your slurm file</span></span>
<span id="cb27-18"><a href="qiime2-on-the-cluster.html#cb27-18" tabindex="-1"></a>rm slurm<span class="sc">-</span><span class="st">&#39;jobID&#39;</span></span></code></pre></div>
</div>
<div id="getting-help" class="section level3 hasAnchor" number="4.1.3">
<h3><span class="header-section-number">4.1.3</span> Getting help<a href="qiime2-on-the-cluster.html#getting-help" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>You can easily view all the options available for each QIIME2 command</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="qiime2-on-the-cluster.html#cb28-1" tabindex="-1"></a><span class="co">#load qiime module first</span></span>
<span id="cb28-2"><a href="qiime2-on-the-cluster.html#cb28-2" tabindex="-1"></a>module load qiime2</span>
<span id="cb28-3"><a href="qiime2-on-the-cluster.html#cb28-3" tabindex="-1"></a></span>
<span id="cb28-4"><a href="qiime2-on-the-cluster.html#cb28-4" tabindex="-1"></a><span class="co">#use the --help option to view all the available options for a qiime command</span></span>
<span id="cb28-5"><a href="qiime2-on-the-cluster.html#cb28-5" tabindex="-1"></a>qiime <span class="sc">--</span>help</span></code></pre></div>
<p>__</p>
<p>You can read more about using QIIME2 on the Alliance (QIIME Wiki Page)[<a href="https://docs.alliancecan.ca/wiki/QIIME" class="uri">https://docs.alliancecan.ca/wiki/QIIME</a>].</p>
<p>To learn more about Apptainer visit the Alliance (Apptainer Wiki page)[<a href="https://docs.alliancecan.ca/wiki/Apptainer" class="uri">https://docs.alliancecan.ca/wiki/Apptainer</a>].</p>
<hr />
 
<hr />
<p style="text-align: center;">
Github: <a href="https://github.com/johannabosch">johannabosch</a> </a>
</p>
<p style="text-align: center;">
<span style="color: #808080;"><em><a href="mailto:yohannabosch@gmail.com" class="email">yohannabosch@gmail.com</a></em></span>
</p>
<!-- Add icon library -->
<p><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"></p>
<!-- Add font awesome icons -->
<p style="text-align: center;">
<a href="https://www.instagram.com/yohannabosch/" class="fa fa-instagram"></a>
<a href="https://www.linkedin.com/in/yan-holtz-2477534a/" class="fa fa-linkedin"></a>
<a href="https://github.com/johannabosch/" class="fa fa-github"></a>
</p>
<p> </p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="importing-data.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="getting-started-with-qiime2.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/USERNAME/REPO/edit/BRANCH/04-Apptainer.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
